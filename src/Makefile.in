DESTDIR =

prefix = $(DESTDIR)/usr
datarootdir = $(prefix)/share
exec_prefix = $(prefix)
bindir = $(exec_prefix)/bin

SHELL = @SHELL@
srcdir = @srcdir@
VPATH = @srcdir@
CC = @CC@
.SUFFIXES: .c .o

PKG_CONFIG = @PKG_CONFIG@
LIBS = @LIBS@ @LFS_LDFLAGS@
DEFS = @DEFS@
#PROF = -fprofile-arcs -pg

PKG_CONFIG_FLAGS=

CFLAGS = -I. -I$(srcdir) $(DEFS) $(PROF) @CFLAGS@ @LFS_CFLAGS@ \
	 `$(PKG_CONFIG) $(PKG_CONFIG_FLAGS) --cflags gtk+-2.0 libxml-2.0 gio-unix-2.0 sm ice`
LDFLAGS = $(PROF) @LDFLAGS@ `$(PKG_CONFIG) $(PKG_CONFIG_FLAGS) --libs gtk+-2.0 libxml-2.0 gio-unix-2.0 sm ice| sed 's/-lpangoxft-[^ ]*//'` $(LIBS)

############ Things to change for different programs

PROG = literocks
APP_DIR = @datarootdir@/$(PROG)

SRCS = $(wildcard *.c)
OBJECTS = $(SRCS:%.c=%.o)

############ Translations

L10N_LANGS = fr
DEST_MO    = $(L10N_LANGS:%=$(datarootdir)/locale/%/LC_MESSAGES/literocks.mo)

############ Things to keep the same

.PHONY: build clean install

all: build

build: $(PROG) Docs/literocks.1 Docs/Manual.html
	$(MAKE) -C po

install: build $(DEST_MO)
	install -D -m755 $(PROG) $(bindir)/$(PROG)

	install -d -m755 $(APP_DIR)
	install -D -m644 $(OBJECTS) Data/Templates.ui Data/Options.xml $(APP_DIR)

	install -d -m755 $(APP_DIR)/images
	install -D -m644 $(wildcard Data/images/*.png) $(APP_DIR)/images
	[ ! -e $(APP_DIR)/images/rox-symlink.png ] && \
		cd $(APP_DIR)/images && ln -s symlink.png rox-symlink.png \
		|| /usr/bin/true

	install -D -m644 Data/literocks.desktop @datarootdir@/applications/$(PROG).desktop
	sed -i 's|{exec}|$(bindir)/$(PROG)|' @datarootdir@/applications/$(PROG).desktop

	install -D -m644 Docs/Manual.html $(APP_DIR)/Help/Manual.html
	install -D -m644 Docs/style.css $(APP_DIR)/Help/style.css
	install -D -m644 Docs/literocks.1 @datarootdir@/man/man1/literocks.1
	install -D -m644 Data/literocks.png @datarootdir@/pixmaps/$(PROG).png
	install -D -m644 ../LICENSE @datarootdir@/licenses/$(PROG)/LICENSE

$(PROG): $(OBJECTS)
	$(CC) -o $@ $(OBJECTS) $(LDFLAGS)

Docs/literocks.1:
	$(MAKE) -C Docs literocks.1

Docs/Manual.html:
	$(MAKE) -C Docs Manual.html

po/%/LC_MESSAGES/literocks.mo:
	$(MAKE) -C po $(@:po/%=%)

$(datarootdir)/locale/%/LC_MESSAGES/literocks.mo: po/%/LC_MESSAGES/literocks.mo
	install -D -m644 $< $@

clean:
	rm -f Makefile configure config.h config.log config.status $(OBJECTS)
	rm -rf autom4te.cache
	$(MAKE) -C Docs clean
	$(MAKE) -C po clean
